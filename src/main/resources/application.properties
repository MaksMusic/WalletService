spring.application.name=WalletService

# Database configuration
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/walletdb}
spring.datasource.username=${DB_USERNAME:walletuser}
spring.datasource.password=${DB_PASSWORD:walletpass}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA configuration
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# Liquibase configuration
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.xml
spring.liquibase.enabled=true

# Connection pool configuration for high load
# тут настраиваю Hikari так чтоб пул не душил rps
# 20 коннктов хватает для 1000 rps из-за коротких транзакций и быстрой отдачи
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# Transaction timeout (in milliseconds)
spring.transaction.default-timeout=${TX_TIMEOUT:30000}

# Server configuration
# Томкат треды чтоб фронт не ждал свободный воркер при всплеске
server.port=${SERVER_PORT:8080}
server.tomcat.threads.max=${TOMCAT_MAX_THREADS:200}
server.tomcat.threads.min-spare=${TOMCAT_MIN_THREADS:10}

# Logging
logging.level.ru.maksm.walletservice=${LOG_LEVEL:INFO}
logging.level.org.springframework.transaction=DEBUG
logging.level.org.hibernate.SQL=${SQL_LOG_LEVEL:WARN}

# Actuator endpoints
management.endpoints.web.exposure.include=health,info,metrics,refresh,loggers,env
management.endpoint.health.show-details=when-authorized

# Spring Cloud Config (client)
spring.config.import=optional:configserver:${CONFIG_SERVER_URL:http://config-server:8888}
spring.cloud.config.label=${CONFIG_GIT_LABEL:main}
spring.cloud.config.name=${CONFIG_APP_NAME:wallet-service}
spring.cloud.config.profile=${SPRING_PROFILES_ACTIVE:default}
